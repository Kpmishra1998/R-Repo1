---
title: "Problem Set 2"
subtitle: "Operation IV"
author: "**EC 425/525:** Econometrics"
date: "<br>Due *before* midnight (11:59pm) on .bold[Wednesday, 29 May 2019]"
output:
  xaringan::moon_reader:
    css: ['default', 'metropolis', 'metropolis-fonts', 'my-css.css']
    # self_contained: true
    nature:
      ratio: '8.5:11'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
class: clear

```{R, setup, include = F}
# Packages
library(pacman)
p_load(
  ggplot2, gridExtra, ggthemes, latex2exp, kableExtra,
  tidyverse, broom, knitr, magrittr
)
# Colors
red_pink <- "#e64173"
turquoise <- "#20B2AA"
grey_light <- "grey70"
grey_mid <- "grey50"
grey_dark <- "grey20"
# Themes
theme_axes_y <- theme_void() + theme(
  text = element_text(family = "sans"),
  axis.title = element_text(size = 11),
  plot.title = element_text(size = 11, hjust = 0.5),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, -0.2, 0, 0, unit = "lines")),
  axis.text.y = element_text(
    size = 10, angle = 0, hjust = 0.9, vjust = 0.5,
    margin = margin(0, 0.4, 0, 0, unit = "lines")
  ),
  axis.line = element_line(
    color = grey_light,
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.07, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_x <- theme_void() + theme(
  text = element_text(family = "sans"),
  axis.title = element_text(size = 11),
  plot.title = element_text(size = 11, hjust = 0.5),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, -0.2, 0, 0, unit = "lines")),
  axis.text.x = element_text(
    size = 10, angle = 0, hjust = 0.9, vjust = 0.5,
    margin = margin(0, 0.4, 0, 0, unit = "lines")
  ),
  axis.line = element_line(
    color = grey_light,
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.07, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_set(theme_gray(base_size = 11))
# Knitr options
opts_chunk$set(
  comment = "#>",
  fig.align = "center",
  warning = F,
  message = F
)
```

.mono.b[DUE] Your solutions to this problem set are due *before* 11:59pm on Wednesday, 29 May 2019 on [Canvas](https://canvas.uoregon.edu/).
<br>Your problem set .hi[must be typed] with .mono[R] code beneath your responses. _E.g._,  [`knitr`](https://yihui.name/knitr/) and [`R Markdown`](https://rmarkdown.rstudio.com).

.mono.b[OBJECTIVE] We're going to walk through three classic applications of instrumental variables/two-stage least squares: measurement error, simultaneity, and randomized encouragement designs (REDs).

#### Measurement error

Let's get this problem set started with a good, old-fashioned simulation.

.b.mono[01] Set up a data-generating process such that
$$
\begin{align}
  y_i = 3 + 7 x_i + u_i
\end{align}
$$
where $x_i\overset{\text{iid}}{\sim}N(5,5)$ and $u_i\overset{\text{iid}}{\sim}N(0,3)$.

In this simulation, we want to imagine what would happen if we could not observe $x_i$ (or if $x_i$ is measured with error/noise).

Thus, we want to create two additional variables: $w_{1i}$ and $w_{2i}$, such that
$$
\begin{align}
  w_{1i} &= x_i + \varepsilon_i \\
  w_{2i} &= x_i + \nu_i
\end{align}
$$
where $\varepsilon_i$ is i.i.d. standard Normal and $\nu_i$ is i.i.d. $N(0,7)$. For this problem, the sample size will be 50.

This setting is *classical* measurement errorâ€”the error (or noise) in measurement (_i.e._, $\varepsilon_i$ and $\nu_i$) is uncorrelated with the true variable $\left( x_i \right)$.

.it[Note] No results for this part of the problem. Just make sure you've set up the DGP.

.mono.b[02] Imagine you cannot observe $x_i$ and are stock with our noisily measured versions $w_{1i}$ and $w_{2i}$. Regress $y_i$ on $w_{1i}$. What do you get? What if you regress $y_i$ on both $w_{1i}$ *and* $w_{2i}$?

.mono.b[03] Now what happens if you *instrument* $w_{1i}$ with $w_{2i}$?

.mono.b[04] Confirm your results form .mono.b[02] and .mono.b[03] were not anomalies. In other words, run a simulation (at least 1,000 iterations) in which you

- regress $y_i$ on $w_{1i}$
- regress $y_i$ on $w_{2i}$
- instrument $w_{1i}$ *and* $w_{2i}$
- instrument $w_{2i}$ *and* $w_{1i}$

Report the results of your simulation. Do you see anything interesting? Does IV outperform OLS in the presence of measurement error (in terms of bias in $\hat{\beta}_1$)? What happens in your inference (look at the share of estimates in which you reject the null)?

.mono.b[05] Now let $x_i$ .b[positively] correlate with $\varepsilon_i$ and .b[negatively] correlate with $\nu_i$, _i.e._, $\mathop{\text{Cov}} \left( x_i,\, \varepsilon_i \right) = 1$ and $\mathop{\text{Cov}} \left( x_i,\, \nu_i \right) = -2$. What happens to your results from .mono.b[04]?

*Hint* You can use `mvrnorm()` from `MASS` to draw correlated variables from a multivariate Normal distribution (which you can assume here). See our simulation lab for details.

---
class: clear

.b[Simultaneity]

.b[Randomized encouragement designs]

Time for some


```{R, generate pdfs, include = F, eval = F}
system("decktape remark ps02.html ps02.pdf --chrome-arg=--allow-file-access-from-files")
```
